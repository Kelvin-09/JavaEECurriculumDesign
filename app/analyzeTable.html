<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>矩阵式下拉列表题型调查结果分析 —— Survey Door 调查系统</title>

  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

  <link rel="stylesheet" href="styles/bootstrap.css">
  <link rel="stylesheet" href="styles/mainPage.css">
  <link rel="stylesheet" href="styles/progressBarStrengthen.css">
</head>
<body>
  <!-- nav start -->
  <nav class="navbar navbar-default navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        <a href="#" class="navbar-brand">
          <img src="images/keyboard_S.png" alt="SurveyDoor">
        </a>
        <a href="#" class="navbar-brand">Survey Door 调查系统</a>
        <button class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="userCenter.html">首页</a></li>
          <li><a href="javascript:void(0)" data-toggle="modal" data-target=".modal-confirm">新建调查</a></li>
          <!-- href="designSurvey.html" -->
          <li><a href="mySurvey.html">我的调查</a></li>
          <li><a href="listSurvey.html">参与调查</a></li>
          <li><a href="register.html">用户注册</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- nav end -->

  <!-- body start -->
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <div class="page-header">
          <h1>
            矩阵式下拉列表题型调查结果分析
            <small>528寝室成员各阶段的学习情况</small>
          </h1>
        </div>
        <div class="form-horizontal" id="chartContent">
          <div class="form-group">
            <label class="control-label col-sm-2">图例</label>
            <div class="col-sm-10">
              <div class="legend-container">
                <div class="legend-box bg-success"></div>
                <label class="legend-label">好</label>
              </div>
              <div class="legend-container">
                <div class="legend-box bg-primary"></div>
                <label class="legend-label">中</label>
              </div>
              <div class="legend-container">
                <div class="legend-box progress-bar-warning"></div>
                <label class="legend-label">差</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2 col-lg-1">小明</label>
            <div class="col-sm-10  col-lg-11">
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">小学</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-success" style="width: 35%;">35</div>
                    <div class="progress-bar progress-bar-primary" style="width: 35%;">35</div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">初中</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-warning" style="width:20%">20</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2 col-lg-1">小明</label>
            <div class="col-sm-10  col-lg-11">
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">小学</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-success" style="width: 35%;">35</div>
                    <div class="progress-bar progress-bar-primary" style="width: 35%;">35</div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">初中</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-warning" style="width:20%">20</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-sm-2 col-lg-1">小明</label>
            <div class="col-sm-10  col-lg-11">
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">小学</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-success" style="width: 35%;">35</div>
                    <div class="progress-bar progress-bar-primary" style="width: 35%;">35</div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-xs-2  col-lg-1">初中</label>
                <div class="col-xs-10  col-lg-11">
                  <div class="progress">
                    <div class="progress-bar progress-bar-warning" style="width:20%">20</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- body end -->
  
  <!-- modal box start -->
  <div class="modal fade modal-confirm">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Hello!</h4>
        </div>
        <div class="modal-body">
          <p>这里有很多有意思的问题模板，希望你能喜欢！</p>
        </div>
        <div class="list-group">
          <!-- <div class="list-group"> -->
            <a href="designSurvey.html" class="list-group-item">
              <h4 class="list-group-item-heading">模板一</h4>
              <p class="list-group-item-text">这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板.</p>
            </a>
            <a href="designSurvey.html" class="list-group-item">
              <h4 class="list-group-item-heading">模板一</h4>
              <p class="list-group-item-text">这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板.</p>
            </a>
            <a href="designSurvey.html" class="list-group-item">
              <h4 class="list-group-item-heading">模板一</h4>
              <p class="list-group-item-text">这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板.</p>
            </a>
            <a href="designSurvey.html" class="list-group-item">
              <h4 class="list-group-item-heading">模板一</h4>
              <p class="list-group-item-text">这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板,这是一个很好的模板.</p>
            </a>
          <!-- </div> -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-default" data-dismiss="modal">Close</button>
          <a href="designSurvey.html" class="btn btn-success">仍然自行创建</a>
          <a href="designSurvey.html" class="btn btn-primary">使用该模板</a>
        </div>
      </div>
    </div>
  </div>
  <!-- modal box end -->

  <!-- footer start -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-md-6">
          <h3>
            <a href="#"><img src="images/keyboard_S.png" alt="SurveyDoor">&nbsp;urvey Door 调查系统</a>
          </h3>
          <p>
            Survey Door 是一个开放的问卷调查平台，用户可以在这里发布自己的问卷，也可以寻找自己感兴趣的问卷并作答。
          </p>
        </div>
        <div class="col-sm-6 col-md-5 col-md-offset-1">
          <div class="row about">
            <div class="col-xs-4">
              <h4>快捷链接</h4>
              <ul class="list-unstyled">
                <li><a href="#">首页</a></li>
                <li><a href="designSurvey.html">新建调查</a></li>
                <li><a href="#">我的调查</a></li>
                <li><a href="#">参与调查</a></li>
              </ul>
            </div>
            <div class="col-xs-4">
              <h4>联系我们</h4>
              <ul class="list-unstyled">
                <li><a href="#">Werun Club</a></li>
                <li><a href="#">12级软件1班</a></li>
                <li><a href="#">HIT@WH</a></li>
              </ul>
            </div>
            <div class="col-xs-4">
              <h4>滥竽充数的链接</h4>
              <ul class="list-unstyled">
                <li><a href="#">Link 1</a></li>
                <li><a href="#">Link 2</a></li>
                <li><a href="#">Link 3</a></li>
                <li><a href="#">Link 4</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <hr />
      <div class="row">
        <ul class="list-inline text-center">
          <li><a href="#">哈尔滨工业大学（威海）软件学院</a></li>
          <li><a href="#">Werun Club</a></li>
        </ul>
      </div>
    </div>
  </footer>
  <!-- footer end -->

  <script type="text/javascript" src="scripts/jquery.js"></script>
  <script type="text/javascript" src="scripts/bootstrap.js"></script>

<script>
$(function () {
  function transformData (data) {
    console.log(data);
    // 用于存储转化完的数据
    var tableObject = {};
    // 数据矩阵
    var tableMatrix = [];
    // 用于缓存指针加快程序速度的
    var tempA, tempB, tempC, tempD;

    switch (data.question.questionType) {
      case 8:
        // 缓存一下数据的几个重要矩阵和对象
        tempA = data.question;
        tempB = tempA.matrixRowTitleArr;
        tempC = tempA.matrixColTitleArr;
        tempD = data.osms;

        // 构建矩阵数组
        $.each(tempB, function (indexI) {
          tableMatrix[indexI] = [];
          $.each(tempC, function (indexJ) {
            tableMatrix[indexI][indexJ] = [];
          });
        })

        // 向矩阵数组中填充数据
        $.each(tempD, function (index, element) {
          tableMatrix[element.matrixRowIndex][element.matrixColIndex][element.matrixSelectIndex] = element.count;
        })

        // 将属性附加到返回对象上
        tableObject.count = data.count;
        tableObject.title = tempA.title;
        tableObject.questionType = tempA.questionType;
        tableObject.matrixRowTitleArr = tempA.matrixRowTitleArr;
        tableObject.matrixColTitleArr = tempA.matrixColTitleArr;
        tableObject.matrixSelectOptionArr = tempA.matrixSelectOptionArr;
        tableObject.dataMatrix = tableMatrix;
        break;
      default:
        alert('接收到的数据格式错误！');
        break;
    }
    return tableObject;
  }

  // 计算总共sum个的情况下，需要使用的color数组
  function calculateColors (sum) {
    var i, tempColor, result = [], colorMax = 16777215;

    for (i = 0; i < sum; ++i) {
      tempColor = (colorMax * i / sum).toString(16);
      tempColor = '#' + new Array(tempColor.length > 6 ? 0 : 6 - tempColor.length + 1).join('0') + tempColor;
      result.push(tempColor);
    }

    return result;
  }

  // 图例标题模板
  var legendTextTemplate = '<label class="control-label col-sm-2">图例</label>';
  // 图例中的container模板
  var colSm10Template = '<div class="col-sm-10"></div>';
  // 图例图像模板
  var legendContainerTemplate = '' + 
    '<div class="legend-container">' + 
      '<div class="legend-box"></div>' + 
      '<label class="legend-label">{0}</label>' + 
    '</div>';
  // form-group模板
  var formGroupTemplate = '<div class="form-group"></div>';
  var progressRowTextTemplate = '<label class="control-label col-sm-2 col-lg-1">{0}</label>';
  var progressColTextTemplate = '<label class="control-label col-xs-2 col-lg-1">{0}</label>';
  var progressRowOutTemplate = '<div class="col-sm-10 col-lg-11"></div>';

  // 制作图例
  function produceLegend (selectOptions, colors) {
    var legendText, legendContainer, legendContainers = [];

    legendText = $(legendTextTemplate);
    $.each(selectOptions, function (index, element) {
      legendContainer = $(legendContainerTemplate.replace(/\{0\}/, element));
      legendContainer.find('.legend-box').css('backgroundColor', colors[index]);
      legendContainers.push(legendContainer);
    })

    return $(formGroupTemplate).append(legendText, $(colSm10Template).append(legendContainers));
  }

  function printData (data) {

    var colors;
    var formGroups = []; // 所有form-group框体

    // 初始化颜色
    colors = calculateColors(data.matrixSelectOptionArr.length);
    // 初始化图例
    formGroups.push(produceLegend(data.matrixSelectOptionArr, colors));

    var i, j, k, lenI, lenJ, lenK;
    var tempRowOptions, tempColOptions, tempSelectOptions;
    var tempMatrix, tempMatrixRow, tempMatrixCol;
    var matrixRowText, matrixColText;
    var matrixRow, matrixCol;
    var matrixCols = [];
    var sortedArray, progressMatrix = [];

    tempRowOptions = data.matrixRowTitleArr;
    tempColOptions = data.matrixColTitleArr;
    tempSelectOptions = data.matrixSelectOptionArr;

    tempMatrix = data.dataMatrix;

    $.each(tempMatrix, function (indexRow, elementRow) {
      matrixCols = [];
      matrixRowText = $(progressRowTextTemplate.replace(/\{0\}/, tempRowOptions[indexRow]));

      $.each(elementRow, function (indexCol, elementCol) {
        progressMatrix = [];
        matrixColText = $(progressColTextTemplate.replace(/\{0\}/, tempColOptions[indexCol]));

        sortedArray = elementCol.slice().sort(function (a, b) { return a - b; });

        matrixCols.push($(formGroupTemplate).append(matrixColText));
      });

      matrixRow = $(formGroupTemplate).append(matrixRowText, $(progressRowOutTemplate).append(matrixCols));
      formGroups.push(matrixRow);
    });


    // for (i = 0, lenI = tempMatrix.length; i < lenI; ++i) {
    //   tempMatrixRow = tempMatrix[i];
    //   matrixCols = [];
    //   matrixRowText = $(progressRowTextTemplate.replace(/\{0\}/, tempRowOptions[i]));

    //   for (j = 0, lenJ = tempMatrixRow.length; j < lenJ; ++j) {
    //     tempMatrixCol = tempMatrixRow[j];
    //     progressMatrix = [];
    //     matrixColText = $(progressColTextTemplate.replace(/\{0\}/, tempColOptions[j]));

    //     sortedArray = tempMatrixCol.slice().sort(function (a, b) { return a - b; });

    //     matrixCols.push($(formGroupTemplate).append(matrixColText));
    //   }

    //   matrixRow = $(formGroupTemplate).append(matrixRowText, $(progressRowOutTemplate).append(matrixCols));
    //   formGroups.push(matrixRow);
    // }

    $('#chartContent').append(formGroups);
  }

  $.ajax({
    url: 'data/analyzeDataChart_02.json',
    type: 'GET',
    dataType: 'json',
    success: function (data) {
      var transformedData;
      transformedData = transformData(data[0]);
      printData(transformedData);
    },
    error: function (data) {
      alert('Can\'t get data');
    }
  });
});
</script>

<!-- <div class="form-group">
  <label class="control-label col-sm-2 col-lg-1">小明</label>
  <div class="col-sm-10 col-lg-11">
    <div class="form-group">
      <label class="control-label col-xs-2 col-lg-1">小学</label>
      <div class="col-xs-10  col-lg-11">
        <div class="progress">
          <div class="progress-bar progress-bar-success" style="width: 35%;">35</div>
          <div class="progress-bar progress-bar-primary" style="width: 35%;">35</div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-xs-2  col-lg-1">初中</label>
      <div class="col-xs-10  col-lg-11">
        <div class="progress">
          <div class="progress-bar progress-bar-warning" style="width:20%">20</div>
        </div>
      </div>
    </div>
  </div>
</div> -->

</body>
</html>